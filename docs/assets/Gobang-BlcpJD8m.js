import{_ as ke,r as c,c as ye,w as U,G as _e,f as he,a as v,b as l,g as N,t as s,u as r,i as z,h as W,v as H,F as j,d as X,p as me,m as Y,l as pe,o as d}from"./index-u-NLfMXx.js";const we={class:"gobang-outer"},xe={class:"gobang-container"},Se={key:0,class:"gobang-rank-card"},Ae={class:"rank-header"},Ie={value:"classic"},Ce={value:"fast"},Pe={class:"rank-list"},Ne={key:0,class:"rank-empty"},Me={class:"rank-index"},Re={class:"rank-name"},Be={class:"rank-streak"},Ge={key:1,class:"mode-select-modal"},Te={class:"mode-select-content"},Le={class:"mode-title"},Oe={key:2,class:"gobang-main"},$e={class:"side-panel"},Je={class:"player-select-row"},Ve={class:"select-label"},Ee=["value","disabled"],Ue={class:"player-select-row",style:{"margin-top":"8px"}},We={class:"select-label"},je=["value","disabled"],De={class:"player-select-row",style:{"margin-top":"8px"}},Fe={class:"info info-side"},ze={key:0,class:"info-text"},He={key:1,class:"info-text"},Xe={key:2,class:"info-text"},Ye={class:"board-bg"},qe={key:0,class:"timer-bar"},Ke={key:0,class:"add-player-modal"},Qe={class:"add-player-content"},Ze={class:"add-player-title"},ea=["placeholder"],aa={class:"add-player-actions"},g=15,ta={__name:"Gobang",setup(la){z("lang"),z("setLang");const n=z("t"),le=pe(),se=!0,m=c(Array.from({length:g},()=>Array(g).fill(0))),p=c(1),y=c(0),G=c(null);let o;const f=c(JSON.parse(localStorage.getItem("gobang_players")||'["玩家A","玩家B"]'));c(f.value[0]);const S=c(f.value[0]),A=c(f.value[1]||f.value[0]),I=c(S.value),w=c(A.value),L=c(!1),O=c("");c(!1);const k=c(""),M=c(20);let $=null;const x=c(!1),J=c(!1),T=c("classic"),R=c([]);function ne(){const e=O.value.trim();!e||f.value.includes(e)||(f.value.push(e),localStorage.setItem("gobang_players",JSON.stringify(f.value)),f.value.length===2&&(w.value=f.value[1]),L.value=!1,O.value="")}function oe(){[I.value,w.value]=[w.value,I.value]}function D(e){return Number(localStorage.getItem("gobang_win_streak_"+e)||0)}function F(e,a){localStorage.setItem("gobang_win_streak_"+e,a)}function q(e){F(e,D(e)+1)}function K(e){F(e,0)}function re(){if(S.value===A.value){const e=f.value.indexOf(S.value);A.value=f.value[(e+1)%f.value.length]}I.value=S.value,w.value=A.value,p.value=1,m.value=Array.from({length:g},()=>Array(g).fill(0)),y.value=0,B()}function ue(){if(A.value===S.value){const e=f.value.indexOf(A.value);S.value=f.value[(e+1)%f.value.length]}I.value=S.value,w.value=A.value,p.value=1,m.value=Array.from({length:g},()=>Array(g).fill(0)),y.value=0,B()}function B(){o&&(o.clearRect(0,0,600,600),o.save(),o.fillStyle="#f8f8e8",o.fillRect(0,0,600,600),o.restore(),ie(),ce())}function ie(){o.save(),o.strokeStyle="#333",o.lineWidth=2;for(let e=0;e<g;e++)o.beginPath(),o.moveTo(20+e*40,20),o.lineTo(20+e*40,580),o.stroke(),o.beginPath(),o.moveTo(20,20+e*40),o.lineTo(580,20+e*40),o.stroke();o.restore()}function ce(){for(let e=0;e<g;e++)for(let a=0;a<g;a++)m.value[e][a]!==0&&(o.beginPath(),o.arc(20+a*40,20+e*40,16,0,Math.PI*2),o.fillStyle=m.value[e][a]===1?"#222":"#fff",o.shadowColor=m.value[e][a]===1?"#555":"#aaa",o.shadowBlur=8,o.fill(),o.shadowBlur=0)}function ve(e){if(y.value||k.value==="fast"&&!x.value)return;const a=G.value.getBoundingClientRect(),t=e.clientX-a.left,u=e.clientY-a.top,_=Math.round((t-20)/40),i=Math.round((u-20)/40);i<0||i>=g||_<0||_>=g||m.value[i][_]===0&&(m.value[i][_]=p.value,de(i,_,p.value)?(y.value=p.value,V()):(p.value=3-p.value,k.value==="fast"&&x.value&&ae()),B())}function de(e,a,t){const u=[[1,0],[0,1],[1,1],[1,-1]];for(let[_,i]of u){let C=1;for(let b=1;b<5;b++){const h=e+_*b,P=a+i*b;if(h<0||h>=g||P<0||P>=g)break;if(m.value[h][P]===t)C++;else break}for(let b=1;b<5;b++){const h=e-_*b,P=a-i*b;if(h<0||h>=g||P<0||P>=g)break;if(m.value[h][P]===t)C++;else break}if(C>=5)return!0}return!1}function Q(){m.value=Array.from({length:g},()=>Array(g).fill(0)),y.value=0,p.value=1,x.value=!1,M.value=20,V(),B()}function ge(){m.value=Array.from({length:g},()=>Array(g).fill(0)),y.value=0,p.value=1,x.value=!1,M.value=20,oe(),V(),B()}function Z(){le.push("/hall")}const fe=ye(()=>y.value?n("gobang.winner")+"："+(y.value===1?I.value:w.value):"");U(y,e=>{e&&(V(),e===1?(q(I.value),K(w.value),te(k.value,I.value,D(I.value))):(q(w.value),K(I.value),te(k.value,w.value,D(w.value))))}),_e(()=>{G.value&&(o=G.value.getContext("2d"),B(),G.value.addEventListener("click",ve))}),U(k,e=>{e&&o&&(x.value=!1,Q())});function ee(e){k.value=e}function be(){x.value=!0,ae()}function ae(){clearInterval($),M.value=20,$=setInterval(()=>{M.value--,M.value<=0&&(clearInterval($),y.value=p.value===1?2:1)},1e3)}function V(){clearInterval($)}async function E(e){try{console.log("加载排行榜 - 使用API模式, mode:",e);const t=await Y.getRankList("gobang",e,10);if(console.log("排行榜API响应:",t),t.success){R.value=t.data.map(u=>({name:u.username,streak:u.streak||0})),console.log("排行榜加载成功:",R.value);return}else console.warn("排行榜API返回失败:",t)}catch(t){console.error("获取排行榜失败:",t)}let a=[];try{a=JSON.parse(localStorage.getItem("gobang_rank_"+e)||"[]"),Array.isArray(a)||(a=[])}catch{a=[]}a.length===0&&(a=[{name:"玩家A",streak:1}],localStorage.setItem("gobang_rank_"+e,JSON.stringify(a))),R.value=a}async function te(e,a,t){console.log("更新排行榜 - useAPI:",se,"mode:",e,"name:",a,"streak:",t);try{let i=t;try{const b=await Y.getRankList("gobang",e,100);if(b.success&&b.data){const h=b.data.find(P=>P.username===a);h&&h.streak!=null?(i=h.streak+1,console.log("从数据库获取当前连胜数:",h.streak,"更新为:",i)):console.log("数据库中没有该玩家记录，使用传入的连胜数:",i)}}catch(b){console.warn("获取当前玩家记录失败，使用传入的连胜数:",b)}const C=await Y.submitRank("gobang",{username:a,mode:e,streak:i});if(console.log("提交排行榜API响应:",C),C.success){console.log("排行榜已更新到数据库:",C.data),F(a,i),await E(e);return}else console.warn("排行榜API提交失败:",C)}catch(i){console.error("提交排行榜失败:",i),console.error("错误详情:",i.message,i.stack)}let u=[];try{u=JSON.parse(localStorage.getItem("gobang_rank_"+e)||"[]"),Array.isArray(u)||(u=[])}catch{u=[]}const _=u.findIndex(i=>i.name===a);_>-1?t>u[_].streak&&(u[_].streak=t):u.push({name:a,streak:t}),u.sort((i,C)=>C.streak-i.streak),u=u.slice(0,10),localStorage.setItem("gobang_rank_"+e,JSON.stringify(u)),R.value=u}return U(T,e=>{E(e)}),U(J,e=>{e&&E(T.value)}),he(()=>{E(T.value)}),(e,a)=>(d(),v(j,null,[a[11]||(a[11]=l("div",{class:"gobang-bg"},null,-1)),l("div",we,[l("div",xe,[l("button",{class:"gobang-rank-btn",onClick:a[0]||(a[0]=t=>J.value=!0)},s(r(n)("gobang.rankBtn")),1),J.value?(d(),v("div",Se,[l("div",Ae,[l("span",null,s(r(n)("gobang.rankHeader")),1),W(l("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>T.value=t),class:"rank-select"},[l("option",Ie,s(r(n)("gobang.classicMode")),1),l("option",Ce,s(r(n)("gobang.fastMode")),1)],512),[[H,T.value]]),l("button",{class:"rank-close",onClick:a[2]||(a[2]=t=>J.value=!1)},s(r(n)("gobang.close")),1)]),l("div",Pe,[R.value.length===0?(d(),v("div",Ne,s(r(n)("gobang.rankEmpty")),1)):N("",!0),(d(!0),v(j,null,X(R.value,(t,u)=>(d(),v("div",{key:u,class:"rank-item"},[l("span",Me,s(u+1)+".",1),l("span",Re,s(t.name),1),l("span",Be,s(t.streak)+" "+s(r(n)("gobang.streak")),1)]))),128))])])):N("",!0),k.value?(d(),v("div",Oe,[l("button",{class:"gobang-exit-btn",onClick:Z},s(r(n)("gobang.back")),1),l("div",$e,[l("div",Je,[l("label",Ve,s(r(n)("gobang.blackPlayer")),1)]),W(l("select",{class:"player-select","onUpdate:modelValue":a[5]||(a[5]=t=>S.value=t),onChange:re},[(d(!0),v(j,null,X(f.value,t=>(d(),v("option",{key:t,value:t,disabled:t===A.value},s(t),9,Ee))),128))],544),[[H,S.value]]),l("div",Ue,[l("label",We,s(r(n)("gobang.whitePlayer")),1)]),W(l("select",{class:"player-select","onUpdate:modelValue":a[6]||(a[6]=t=>A.value=t),onChange:ue},[(d(!0),v(j,null,X(f.value,t=>(d(),v("option",{key:t,value:t,disabled:t===S.value},s(t),9,je))),128))],544),[[H,A.value]]),l("div",De,[l("button",{class:"add-player-btn",onClick:a[7]||(a[7]=t=>L.value=!0)},s(r(n)("gobang.addPlayerBtn")),1)]),l("div",Fe,[y.value?(d(),v("div",ze,s(fe.value),1)):k.value==="fast"&&!x.value?(d(),v("div",He,s(r(n)("gobang.readyToStart")),1)):(d(),v("div",Xe,s(r(n)("gobang.currentRound"))+": "+s(p.value===1?I.value:w.value),1)),k.value==="fast"&&!x.value?(d(),v("button",{key:3,class:"start-game-btn",onClick:be},s(r(n)("gobang.startGame")),1)):N("",!0),x.value||k.value==="classic"?(d(),v("button",{key:4,onClick:Q},s(r(n)("gobang.reset")),1)):N("",!0),x.value||k.value==="classic"?(d(),v("button",{key:5,class:"next-btn",onClick:ge},s(r(n)("gobang.nextGame")),1)):N("",!0),l("button",{class:"exit-btn",onClick:a[8]||(a[8]=t=>k.value="")},s(r(n)("gobang.back")),1)])]),l("div",Ye,[l("canvas",{ref_key:"canvas",ref:G,width:"600",height:"600",class:"gobang-canvas"},null,512),k.value==="fast"&&x.value&&!y.value?(d(),v("div",qe,[l("span",null,s(r(n)("gobang.timer"))+": "+s(M.value)+" "+s(r(n)("gobang.seconds")),1)])):N("",!0)]),L.value?(d(),v("div",Ke,[l("div",Qe,[l("div",Ze,s(r(n)("gobang.addPlayerTitle")),1),W(l("input",{"onUpdate:modelValue":a[9]||(a[9]=t=>O.value=t),placeholder:r(n)("gobang.playerNamePlaceholder"),maxlength:"10"},null,8,ea),[[me,O.value]]),l("div",aa,[l("button",{onClick:ne},s(r(n)("gobang.add")),1),l("button",{onClick:a[10]||(a[10]=t=>L.value=!1)},s(r(n)("gobang.cancel")),1)])])])):N("",!0)])):(d(),v("div",Ge,[l("div",Te,[l("div",Le,s(r(n)("gobang.modeSelectTitle")),1),l("button",{class:"mode-btn",onClick:a[3]||(a[3]=t=>ee("classic"))},s(r(n)("gobang.classicMode")),1),l("button",{class:"mode-btn",onClick:a[4]||(a[4]=t=>ee("fast"))},s(r(n)("gobang.fastMode")),1),l("button",{class:"mode-btn",style:{"margin-top":"32px",background:"linear-gradient(90deg,#ffb347,#ff7043)",color:"#fff"},onClick:Z},s(r(n)("gobang.exitGame")),1)])]))])])],64))}},na=ke(ta,[["__scopeId","data-v-fb0f147b"]]);export{na as default};
