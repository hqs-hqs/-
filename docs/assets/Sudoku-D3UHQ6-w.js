import{_ as Ae,r as z,c as me,e as Ne,w as Te,f as Ve,a as _,b as a,g as T,t as c,u as k,i as se,h as te,v as De,F as A,d as P,n as F,j as Q,k as Be,l as Oe,m as ke,o as b,p as ge,q as he}from"./index-u-NLfMXx.js";const Re={class:"sudoku-outer"},Ue={class:"sudoku-container"},Je={key:0,class:"sudoku-rank-card"},Pe={class:"rank-header"},Fe={value:"classic"},Ke={value:"diagonal"},Ge={value:"killer"},He={class:"rank-list"},qe={key:0,class:"rank-empty"},Ee={class:"rank-index"},Ye={class:"rank-time"},Qe={class:"rank-date"},We={class:"mode-select"},Xe={class:"entry-btns"},Ze={style:{"margin-bottom":"10px",color:"#7a4fd3","font-weight":"600","font-size":"1.1rem"}},je={style:{"margin-left":"12px",color:"#a084ee","font-size":"1rem"}},el={key:0,class:"board"},ll=["onUpdate:modelValue","readonly","onInput"],sl=["onUpdate:modelValue","readonly","onInput"],tl={key:1,style:{padding:"20px","text-align":"center",color:"#7a4fd3"}},al={class:"info"},ul={class:"btns-flex"},ol=["disabled"],nl=["disabled"],rl={key:0,class:"timer"},cl={key:0,class:"sudoku-msg"},il={key:2,class:"answer-modal"},dl={class:"answer-content"},vl={key:0,style:{color:"#e67e22","font-size":"1.1em","margin-bottom":"8px"}},fl={class:"answer-board"},ml={key:3,class:"sudoku-help-modal"},kl={class:"sudoku-help-content"},gl={style:{"text-align":"left","line-height":"1.8","font-size":"1.08em"}},hl={__name:"Sudoku",setup(pl){se("lang"),se("setLang");const m=se("t"),pe=Oe(),ae=localStorage.getItem("game_user_id")?Number(localStorage.getItem("game_user_id")):null,ye=localStorage.getItem("game_username")||"游客",h=z("classic");function W(l){try{h.value=l,p.value=0,Be(()=>{if(!x.value||x.value.length===0){console.error("levels.value is empty after mode change:",l,"levels:",x.value,"diagonalLevels:",Z,"killerPuzzles:",killerPuzzles);return}le(),l==="killer"?q():C.value={}})}catch(e){console.error("setMode error:",e)}}const X=[{puzzle:[[5,3,0,0,7,0,0,0,0],[6,0,0,1,9,5,0,0,0],[0,9,8,0,0,0,0,6,0],[8,0,0,0,6,0,0,0,3],[4,0,0,8,0,3,0,0,1],[7,0,0,0,2,0,0,0,6],[0,6,0,0,0,0,2,8,0],[0,0,0,4,1,9,0,0,5],[0,0,0,0,8,0,0,7,9]],answer:[[5,3,4,6,7,8,9,1,2],[6,7,2,1,9,5,3,4,8],[1,9,8,3,4,2,5,6,7],[8,5,9,7,6,1,4,2,3],[4,2,6,8,5,3,7,9,1],[7,1,3,9,2,4,8,5,6],[9,6,1,5,3,7,2,8,4],[2,8,7,4,1,9,6,3,5],[3,4,5,2,8,6,1,7,9]]},{puzzle:[[0,0,0,2,6,0,7,0,1],[6,8,0,0,7,0,0,9,0],[1,9,0,0,0,4,5,0,0],[8,2,0,1,0,0,0,4,0],[0,0,4,6,0,2,9,0,0],[0,5,0,0,0,3,0,2,8],[0,0,9,3,0,0,0,7,4],[0,4,0,0,5,0,0,3,6],[7,0,3,0,1,8,0,0,0]],answer:[[4,3,5,2,6,9,7,8,1],[6,8,2,5,7,1,4,9,3],[1,9,7,8,3,4,5,6,2],[8,2,6,1,9,5,3,4,7],[3,7,4,6,8,2,9,1,5],[9,5,1,7,4,3,6,2,8],[5,1,9,3,2,6,8,7,4],[2,4,8,9,5,7,1,3,6],[7,6,3,4,1,8,2,5,9]]},{puzzle:[[0,2,0,6,0,8,0,0,0],[5,8,0,0,0,9,7,0,0],[0,0,0,0,4,0,0,0,0],[3,7,0,0,0,0,5,0,0],[6,0,0,0,0,0,0,0,4],[0,0,8,0,0,0,0,1,3],[0,0,0,0,2,0,0,0,0],[0,0,9,8,0,0,0,3,6],[0,0,0,3,0,6,0,9,0]],answer:[[1,2,7,6,3,8,9,4,5],[5,8,4,2,1,9,7,6,3],[9,6,3,7,4,5,8,2,1],[3,7,1,9,8,2,5,4,6],[6,9,2,5,7,1,3,8,4],[4,5,8,3,6,7,2,1,9],[7,4,6,1,2,3,4,5,8],[2,1,9,8,5,4,1,3,6],[8,3,5,4,9,6,6,7,2]]},{puzzle:[[0,0,0,0,0,0,0,1,2],[0,0,0,0,0,7,0,0,0],[0,0,1,0,9,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,5,3,8,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,8,0,4,0,0],[0,0,0,6,0,0,0,0,0],[3,6,0,0,0,0,0,0,0]],answer:[[7,4,5,3,6,8,9,1,2],[9,8,2,1,4,7,5,6,3],[6,3,1,2,9,5,7,8,4],[8,1,9,4,7,6,3,2,5],[2,7,6,5,3,8,1,4,9],[4,5,3,9,1,2,6,7,8],[1,2,7,9,8,3,4,5,6],[5,9,4,6,2,1,8,3,7],[3,6,8,7,5,4,2,9,1]]},{puzzle:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,3,0,8,5],[0,0,1,0,2,0,0,0,0],[0,0,0,5,0,7,0,0,0],[0,0,4,0,0,0,1,0,0],[0,9,0,0,0,0,0,0,0],[5,0,0,0,0,0,0,7,3],[0,0,2,0,1,0,0,0,0],[0,0,0,0,4,0,0,0,9]],answer:[[9,7,8,4,6,1,2,3,5],[2,4,6,9,7,3,1,8,5],[3,5,1,8,2,6,9,4,7],[1,2,3,5,9,7,4,6,8],[7,6,4,2,3,8,1,5,9],[8,9,5,1,4,2,6,7,3],[5,1,9,6,8,4,7,2,3],[4,3,2,7,1,9,5,6,8],[6,8,7,3,5,4,2,1,9]]}],ue=["简单","普通","中等","困难","极难"],Z=[{puzzle:[[0,0,0,0,0,0,0,1,2],[0,0,0,0,0,7,0,0,0],[0,0,1,0,9,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,5,3,8,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,8,0,4,0,0],[0,0,0,6,0,0,0,0,0],[3,6,0,0,0,0,0,0,0]],answer:[[7,4,5,3,6,8,9,1,2],[9,8,2,1,4,7,5,6,3],[6,3,1,2,9,5,7,8,4],[8,1,9,4,7,6,3,2,5],[2,7,6,5,3,8,1,4,9],[4,5,3,9,1,2,6,7,8],[1,2,7,9,8,3,4,5,6],[5,9,4,6,2,1,8,3,7],[3,6,8,7,5,4,2,9,1]]},{puzzle:[[0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,2,0],[0,0,0,0,0,3,0,0,0],[0,0,0,0,4,0,0,0,0],[0,0,0,5,0,0,0,0,0],[0,0,6,0,0,0,0,0,0],[0,7,0,0,0,0,0,0,0],[8,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,9,0,0]],answer:[[2,3,4,5,6,7,8,9,1],[1,4,5,6,7,8,9,2,3],[7,8,9,1,2,3,4,5,6],[3,1,2,4,5,6,7,8,9],[4,6,7,8,9,1,2,3,5],[5,9,1,2,3,4,6,7,8],[6,2,3,7,8,9,1,4,5],[9,5,6,7,1,2,3,4,8],[8,7,2,3,4,5,9,6,1]]},{puzzle:[[4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,5,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,6]],answer:[[4,1,2,3,6,7,8,9,5],[3,5,6,1,8,9,2,4,7],[7,8,9,2,4,5,1,3,6],[1,2,3,4,7,8,5,6,9],[6,4,7,9,5,1,3,8,2],[5,9,8,6,3,2,4,7,1],[2,3,1,5,9,4,6,1,8],[8,6,4,7,1,3,9,5,2],[9,7,5,8,2,6,7,4,3]]}],_e=["对角线1","对角线2","对角线3"],V=[{puzzle:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],cages:[{sum:3,cells:[[0,0],[0,1]]},{sum:3,cells:[[0,2]]},{sum:9,cells:[[0,3],[0,4]]},{sum:6,cells:[[0,5]]},{sum:15,cells:[[0,6],[0,7]]},{sum:9,cells:[[0,8]]},{sum:9,cells:[[1,0],[1,1]]},{sum:6,cells:[[1,2]]},{sum:15,cells:[[1,3],[1,4]]},{sum:9,cells:[[1,5]]},{sum:3,cells:[[1,6],[1,7]]},{sum:3,cells:[[1,8]]},{sum:15,cells:[[2,0],[2,1]]},{sum:9,cells:[[2,2]]},{sum:3,cells:[[2,3],[2,4]]},{sum:3,cells:[[2,5]]},{sum:9,cells:[[2,6],[2,7]]},{sum:6,cells:[[2,8]]},{sum:2,cells:[[3,0]]},{sum:7,cells:[[3,1],[3,2]]},{sum:11,cells:[[3,3],[3,4]]},{sum:7,cells:[[3,5]]},{sum:17,cells:[[3,6],[3,7]]},{sum:1,cells:[[3,8]]},{sum:11,cells:[[4,0],[4,1]]},{sum:15,cells:[[4,2],[4,3]]},{sum:9,cells:[[4,4]]},{sum:3,cells:[[4,5],[4,6]]},{sum:7,cells:[[4,7],[4,8]]},{sum:17,cells:[[5,0],[5,1]]},{sum:1,cells:[[5,2]]},{sum:5,cells:[[5,3],[5,4]]},{sum:9,cells:[[5,5],[5,6]]},{sum:13,cells:[[5,7],[5,8]]},{sum:7,cells:[[6,0],[6,1]]},{sum:11,cells:[[6,2],[6,3]]},{sum:15,cells:[[6,4],[6,5]]},{sum:10,cells:[[6,6],[6,7]]},{sum:2,cells:[[6,8]]},{sum:13,cells:[[7,0],[7,1]]},{sum:8,cells:[[7,2]]},{sum:10,cells:[[7,3],[7,4]]},{sum:5,cells:[[7,5],[7,6]]},{sum:9,cells:[[7,7],[7,8]]},{sum:10,cells:[[8,0],[8,1]]},{sum:2,cells:[[8,2]]},{sum:7,cells:[[8,3],[8,4]]},{sum:11,cells:[[8,5],[8,6]]},{sum:15,cells:[[8,7],[8,8]]}],answer:[[1,2,3,4,5,6,7,8,9],[4,5,6,7,8,9,1,2,3],[7,8,9,1,2,3,4,5,6],[2,3,4,5,6,7,8,9,1],[5,6,7,8,9,1,2,3,4],[8,9,1,2,3,4,5,6,7],[3,4,5,6,7,8,9,1,2],[6,7,8,9,1,2,3,4,5],[9,1,2,3,4,5,6,7,8]]},{puzzle:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],cages:[{sum:8,cells:[[0,0],[0,1]]},{sum:4,cells:[[0,2]]},{sum:13,cells:[[0,3],[0,4]]},{sum:8,cells:[[0,5]]},{sum:10,cells:[[0,6],[0,7]]},{sum:2,cells:[[0,8]]},{sum:13,cells:[[1,0],[1,1]]},{sum:2,cells:[[1,2]]},{sum:10,cells:[[1,3],[1,4]]},{sum:5,cells:[[1,5]]},{sum:7,cells:[[1,6],[1,7]]},{sum:8,cells:[[1,8]]},{sum:10,cells:[[2,0],[2,1]]},{sum:8,cells:[[2,2]]},{sum:7,cells:[[2,3],[2,4]]},{sum:2,cells:[[2,5]]},{sum:11,cells:[[2,6],[2,7]]},{sum:7,cells:[[2,8]]},{sum:13,cells:[[3,0],[3,1]]},{sum:9,cells:[[3,2]]},{sum:13,cells:[[3,3],[3,4]]},{sum:1,cells:[[3,5]]},{sum:6,cells:[[3,6],[3,7]]},{sum:3,cells:[[3,8]]},{sum:6,cells:[[4,0],[4,1]]},{sum:6,cells:[[4,2]]},{sum:13,cells:[[4,3],[4,4]]},{sum:3,cells:[[4,5]]},{sum:16,cells:[[4,6],[4,7]]},{sum:1,cells:[[4,8]]},{sum:8,cells:[[5,0],[5,1]]},{sum:3,cells:[[5,2]]},{sum:11,cells:[[5,3],[5,4]]},{sum:4,cells:[[5,5]]},{sum:13,cells:[[5,6],[5,7]]},{sum:6,cells:[[5,8]]},{sum:15,cells:[[6,0],[6,1]]},{sum:1,cells:[[6,2]]},{sum:8,cells:[[6,3],[6,4]]},{sum:7,cells:[[6,5]]},{sum:10,cells:[[6,6],[6,7]]},{sum:4,cells:[[6,8]]},{sum:10,cells:[[7,0],[7,1]]},{sum:7,cells:[[7,2]]},{sum:5,cells:[[7,3],[7,4]]},{sum:9,cells:[[7,5]]},{sum:9,cells:[[7,6],[7,7]]},{sum:5,cells:[[7,8]]},{sum:7,cells:[[8,0],[8,1]]},{sum:5,cells:[[8,2]]},{sum:10,cells:[[8,3],[8,4]]},{sum:6,cells:[[8,5]]},{sum:8,cells:[[8,6],[8,7]]},{sum:9,cells:[[8,8]]}],answer:[[5,3,4,6,7,8,9,1,2],[6,7,2,1,9,5,3,4,8],[1,9,8,3,4,2,5,6,7],[8,5,9,7,6,1,4,2,3],[4,2,6,8,5,3,7,9,1],[7,1,3,9,2,4,8,5,6],[9,6,1,5,3,7,2,8,4],[2,8,7,4,1,9,6,3,5],[3,4,5,2,8,6,1,7,9]]}],be=["杀手1","杀手2"],x=me(()=>{const l=h.value;return l==="classic"?X.map(e=>e.puzzle):l==="diagonal"?Z.map(e=>e.puzzle):l==="killer"?V.map(e=>e.puzzle):X.map(e=>e.puzzle)}),K={classic:X.map(l=>l.answer),diagonal:Z.map(l=>l.answer),killer:V.map(l=>l.answer)},oe=me(()=>{const l=h.value;return l==="classic"?ue:l==="diagonal"?_e:l==="killer"?be:ue}),p=z(0),M=z([]),S=z([]);function j(){try{const l=x.value;if(!l||l.length===0){console.warn("levels.value is empty, skipping initPuzzle");return}(p.value<0||p.value>=l.length)&&(console.warn(`currentLevel ${p.value} is out of range, resetting to 0`),p.value=0),M.value=JSON.parse(JSON.stringify(l[p.value])),S.value=l[p.value].map(e=>e.map(t=>t===0?"":String(t)))}catch(l){console.error("initPuzzle error:",l),M.value=Array(9).fill(null).map(()=>Array(9).fill(0)),S.value=Array(9).fill(null).map(()=>Array(9).fill(""))}}const w=z(""),G=z(!1),H=z(!1),U=z([]),ee=z(!1),N=z("classic"),ne=["#e67e22","#3498db","#27ae60","#9b59b6","#e74c3c","#16a085","#f39c12","#2980b9","#8e44ad","#2ecc71"],C=z({});function q(){if(h.value!=="killer"){C.value={};return}const l={},e=V[p.value].cages;for(let t=0;t<e.length;t++){const s=e[t],d=ne[t%ne.length],u=s.sum;for(const[v,f]of s.cells){const r=`${v},${f}`;l[r]||(l[r]={top:!Y(v,f,s,-1,0),bottom:!Y(v,f,s,1,0),left:!Y(v,f,s,0,-1),right:!Y(v,f,s,0,1),isTopLeft:Le(v,f,s),cageIdx:t,borderColor:d,sumBg:{background:d+"22",color:d},sum:u})}}C.value=l}const re={classic:"sudoku_rank_classic",diagonal:"sudoku_rank_diagonal",killer:"sudoku_rank_killer"},we={classic:[{time:574,date:"2024-对角线1"},{time:741,date:"2024-普通"},{time:1085,date:"2024-极难"}],diagonal:[{time:599,date:"2024-对角线1"},{time:900,date:"2024-对角线2"},{time:1200,date:"2024-对角线2"}],killer:[{time:800,date:"2024-杀手1"},{time:1100,date:"2024-杀手2"},{time:1500,date:"2024-杀手2"}]};function le(){j(),w.value=""}function ce(l){if(!x.value||x.value.length===0)return;let e=p.value+l;e<0&&(e=0);const t=x.value.length;e>=t&&(e=t-1),e!==p.value&&(p.value=e,le(),h.value==="killer"&&q())}function ze(){for(let l=0;l<9;l++){const e=new Set,t=new Set;for(let s=0;s<9;s++){const d=S.value[l][s],u=S.value[s][l];if(!d||!u){w.value="请填写完整";return}if(e.has(d))return w.value=`第${l+1}行有重复`;if(e.add(d),t.has(u))return w.value=`第${l+1}列有重复`;t.add(u)}}for(let l=0;l<9;l++){const e=new Set;for(let t=0;t<3;t++)for(let s=0;s<3;s++){const d=S.value[Math.floor(l/3)*3+t][l%3*3+s];if(!d){w.value="请填写完整";return}if(e.has(d))return w.value=`第${l+1}宫有重复`;e.add(d)}}if(h.value==="diagonal"){const l=new Set,e=new Set;for(let t=0;t<9;t++){const s=S.value[t][t],d=S.value[t][8-t];if(l.has(s))return w.value="主对角线有重复";if(e.has(d))return w.value="副对角线有重复";l.add(s),e.add(d)}}if(h.value==="killer"){const l=V[p.value].cages;for(const e of l){let t=0;const s=new Set;for(const[d,u]of e.cells){const v=Number(S.value[d][u]);if(!v){w.value="请填写完整";return}if(s.has(v))return w.value="笼子内有重复数字";s.add(v),t+=v}if(t!==e.sum)return w.value=`有笼子数字之和不等于${e.sum}`}}w.value="校验通过！",O.value>0&&Me(O.value)}function ie(l,e){if(M.value[l][e])return;let t=S.value[l][e];/^[1-9]?$/.test(t)||(S.value[l][e]="")}function $e(){(!M.value||M.value.length===0)&&j(),h.value==="killer"&&Object.keys(C.value).length===0&&q(),G.value=!0}function de(){G.value?(G.value=!1,D.value&&(clearInterval(D.value),D.value=null,J.value=!1),O.value=0,w.value="",B.value=!1):pe.back()}const D=z(null),J=z(!1),O=z(0);function Se(){J.value?(clearInterval(D.value),J.value=!1):(J.value=!0,D.value=setInterval(()=>{O.value++},1e3))}function ve(l){const e=Math.floor(l/60),t=l%60;return`${e}:${t.toString().padStart(2,"0")}`}Ne(()=>{D.value&&clearInterval(D.value)}),z({classic:Array(5).fill(null),diagonal:Array(3).fill(null),killer:Array(2).fill(null)});const B=z(!1),E=z(!1);function Ce(){var t;const l=h.value;let e=(t=K[l])==null?void 0:t[p.value];if(e){let s=function(u){const v=u.map(o=>o.slice());function f(o,n,i){for(let g=0;g<9;g++)if(v[o][g]===i||v[g][n]===i)return!1;const $=Math.floor(o/3)*3,y=Math.floor(n/3)*3;for(let g=0;g<3;g++)for(let L=0;L<3;L++)if(v[$+g][y+L]===i)return!1;if(h.value==="diagonal"){if(o===n){for(let g=0;g<9;g++)if(v[g][g]===i)return!1}if(o+n===8){for(let g=0;g<9;g++)if(v[g][8-g]===i)return!1}}return!0}function r(o=0){if(o===81)return d++,d>1;const n=Math.floor(o/9),i=o%9;if(v[n][i])return r(o+1);for(let $=1;$<=9;$++)if(f(n,i,$)){if(v[n][i]=$,r(o+1))return!0;v[n][i]=0}return!1}r()},d=0;h.value==="killer"&&p.value===1?E.value=!0:h.value==="diagonal"&&p.value===1?(s(x.value[p.value]),E.value=d!==1):E.value=!1,B.value=!0;return}if(h.value==="killer"){w.value="正在计算答案，请稍候...",B.value=!1,setTimeout(()=>{try{if(e=Ie(V[p.value].puzzle,V[p.value].cages,p.value),!e||!Array.isArray(e)||e.length===0||e.every(s=>s.every(d=>d===0))){w.value="计算答案失败，请重试",console.error("杀手数独答案无效:",e);return}K.killer[p.value]=e,w.value="",B.value=!0}catch(s){console.error("计算答案失败:",s),w.value="计算答案失败，请重试"}},100);return}else{if(e=xe(x.value[p.value]),!e||e.length===0){w.value="计算答案失败，请重试";return}K[l][p.value]=e,B.value=!0}}function xe(l){const e=l.map(r=>r.slice()),t=Array.from({length:9},()=>new Set),s=Array.from({length:9},()=>new Set),d=Array.from({length:9},()=>new Set),u=new Set,v=new Set;for(let r=0;r<9;r++)for(let o=0;o<9;o++){const n=e[r][o];n&&(t[r].add(n),s[o].add(n),d[Math.floor(r/3)*3+Math.floor(o/3)].add(n),h.value==="diagonal"&&(r===o&&u.add(n),r+o===8&&v.add(n)))}function f(r=0){if(r===81)return!0;const o=Math.floor(r/9),n=r%9;if(e[o][n])return f(r+1);for(let i=1;i<=9;i++)if(!(t[o].has(i)||s[n].has(i)||d[Math.floor(o/3)*3+Math.floor(n/3)].has(i))&&!(h.value==="diagonal"&&(o===n&&u.has(i)||o+n===8&&v.has(i)))){if(e[o][n]=i,t[o].add(i),s[n].add(i),d[Math.floor(o/3)*3+Math.floor(n/3)].add(i),h.value==="diagonal"&&(o===n&&u.add(i),o+n===8&&v.add(i)),f(r+1))return!0;e[o][n]=0,t[o].delete(i),s[n].delete(i),d[Math.floor(o/3)*3+Math.floor(n/3)].delete(i),h.value==="diagonal"&&(o===n&&u.delete(i),o+n===8&&v.delete(i))}return!1}return f(),e}async function fe(){try{const t=await ke.getRankList("sudoku",N.value,10);if(t.success){U.value=t.data.map(s=>{let d="未知日期";try{s.rankData&&(d=JSON.parse(s.rankData).date||d)}catch{}return{time:s.time,date:d}});return}}catch(t){console.error("获取排行榜失败:",t)}let l=[];const e=re[N.value];try{l=JSON.parse(localStorage.getItem(e)||"[]"),Array.isArray(l)||(l=[])}catch{l=[]}l.length===0&&(l=we[N.value],localStorage.setItem(e,JSON.stringify(l))),U.value=l}async function Me(l){if(ae)try{const u=new Date,v=`${u.getFullYear()}-${u.getMonth()+1}-${u.getDate()}`,f=JSON.stringify({date:v}),r=await ke.submitRank("sudoku",{userId:ae,username:ye,mode:h.value,time:l,rankData:f});if(r.success){console.log("排行榜已更新:",r.data),N.value===h.value&&await fe();return}}catch(u){console.error("提交排行榜失败:",u)}const e=re[h.value];let t=[];try{t=JSON.parse(localStorage.getItem(e)||"[]"),Array.isArray(t)||(t=[])}catch{t=[]}const s=new Date,d=`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}`;t.push({time:l,date:d}),t.sort((u,v)=>u.time-v.time),t=t.slice(0,10),localStorage.setItem(e,JSON.stringify(t)),N.value===h.value&&(U.value=t)}Te([H,N],([l])=>{l&&setTimeout(()=>{fe().catch(e=>{console.error("loadRankList error:",e)})},0)}),Ve(()=>{setTimeout(()=>{try{j(),h.value==="killer"&&q()}catch(l){console.error("onMounted initialization error:",l)}},0)});function Le(l,e,t){return t.cells.every(([s,d])=>s>l||s===l&&d>=e)}function Y(l,e,t,s,d){return t.cells.some(([u,v])=>u===l+s&&v===e+d)}function Ie(l,e,t){const s=l.map(f=>f.slice());function d(f,r,o){const n=V[o].cages;for(let i=0;i<n.length;i++)if(n[i].cells.some(([$,y])=>$===f&&y===r))return i;return-1}function u(f,r,o){for(let y=0;y<9;y++)if(s[f][y]===o||s[y][r]===o)return!1;const n=Math.floor(f/3)*3,i=Math.floor(r/3)*3;for(let y=0;y<3;y++)for(let g=0;g<3;g++)if(s[n+y][i+g]===o)return!1;const $=d(f,r,t);if($!==-1){const y=e[$];let g=o,L=1;for(const[R,I]of y.cells)R===f&&I===r||s[R][I]!==0&&(g+=s[R][I],L++);if(L===y.cells.length){if(g!==y.sum)return!1}else if(g>y.sum)return!1}return!0}function v(f=0){if(f===81){for(const n of e){let i=0;for(const[$,y]of n.cells)i+=s[$][y];if(i!==n.sum)return!1}return!0}const r=Math.floor(f/9),o=f%9;if(s[r][o]!==0)return v(f+1);for(let n=1;n<=9;n++)if(u(r,o,n)){if(s[r][o]=n,v(f+1))return!0;s[r][o]=0}return!1}return v()?s:(console.error("杀手数独求解失败"),null)}return(l,e)=>(b(),_(A,null,[e[11]||(e[11]=a("div",{class:"sudoku-bg"},null,-1)),a("div",Re,[a("div",Ue,[a("button",{class:"sudoku-help-btn",onClick:e[0]||(e[0]=t=>ee.value=!0)},c(k(m)("sudoku.help")),1),a("button",{class:"sudoku-rank-btn",onClick:e[1]||(e[1]=t=>H.value=!0)},c(k(m)("sudoku.rankBtn")),1),H.value?(b(),_("div",Je,[a("div",Pe,[a("span",null,c(k(m)("sudoku.rankHeader")),1),te(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>N.value=t),class:"rank-select",style:{margin:"0 8px"}},[a("option",Fe,c(k(m)("sudoku.classic")),1),a("option",Ke,c(k(m)("sudoku.diagonal")),1),a("option",Ge,c(k(m)("sudoku.killer")),1)],512),[[De,N.value]]),a("button",{class:"rank-close",onClick:e[3]||(e[3]=t=>H.value=!1)},c(k(m)("sudoku.rankClose")),1)]),a("div",He,[U.value.length===0?(b(),_("div",qe,c(k(m)("sudoku.rankEmpty")),1)):T("",!0),(b(!0),_(A,null,P(U.value,(t,s)=>(b(),_("div",{key:s,class:"rank-item"},[a("span",Ee,c(s+1)+".",1),a("span",Ye,c(ve(t.time)),1),a("span",Qe,c(t.date),1)]))),128))])])):T("",!0),G.value?(b(),_(A,{key:2},[a("h2",null,c(k(m)("sudoku.title")),1),a("div",Ze,[Q(" 关卡 "+c(p.value+1)+" / "+c(x.value.length||0)+" ",1),a("span",je,"("+c(oe.value&&oe.value[p.value]||"")+")",1)]),M.value.length>0&&S.value.length>0?(b(),_("div",el,[(b(),_(A,null,P(9,(t,s)=>a("div",{key:s,class:"row"},[(b(),_(A,null,P(9,(d,u)=>{var v,f,r,o,n,i,$,y,g,L,R;return a("div",{key:u,style:{position:"relative",display:"inline-block"}},[h.value!=="killer"?te((b(),_("input",{key:0,maxlength:"1",type:"text","onUpdate:modelValue":I=>S.value[s][u]=I,readonly:!!((v=M.value[s])!=null&&v[u]),class:F(["killer-input",{fixed:!!((f=M.value[s])!=null&&f[u])}]),onInput:I=>ie(s,u),"aria-label":"数独格子",placeholder:""},null,42,ll)),[[ge,S.value[s][u]]]):(b(),_(A,{key:1},[te(a("input",{maxlength:"1",type:"text","onUpdate:modelValue":I=>S.value[s][u]=I,readonly:!!((r=M.value[s])!=null&&r[u]),class:F(["killer-input",{fixed:!!((o=M.value[s])!=null&&o[u])},C.value[`${s},${u}`]?"killer-cage":"",(n=C.value[`${s},${u}`])!=null&&n.top?"cage-top":"",(i=C.value[`${s},${u}`])!=null&&i.bottom?"cage-bottom":"",($=C.value[`${s},${u}`])!=null&&$.left?"cage-left":"",(y=C.value[`${s},${u}`])!=null&&y.right?"cage-right":""]),onInput:I=>ie(s,u),"aria-label":"数独格子",placeholder:"",style:he(C.value[`${s},${u}`]?{"--killer-cage-color":C.value[`${s},${u}`].borderColor}:{})},null,46,sl),[[ge,S.value[s][u]]]),(g=C.value[`${s},${u}`])!=null&&g.isTopLeft?(b(),_("span",{key:0,class:"killer-cage-sum",style:he(((L=C.value[`${s},${u}`])==null?void 0:L.sumBg)||{})},c((R=C.value[`${s},${u}`])==null?void 0:R.sum),5)):T("",!0)],64))])}),64))])),64))])):(b(),_("div",tl," 加载中... ")),a("div",al,[a("div",ul,[a("button",{onClick:e[7]||(e[7]=t=>ce(-1)),disabled:p.value===0},c(k(m)("sudoku.prevLevel")),9,ol),a("button",{onClick:le},c(k(m)("sudoku.reset")),1),a("button",{onClick:ze},c(k(m)("sudoku.check")),1),a("button",{onClick:e[8]||(e[8]=t=>ce(1)),disabled:!x.value||x.value.length===0||p.value===x.value.length-1},c(k(m)("sudoku.nextLevel")),9,nl),a("button",{onClick:Se},c(J.value?k(m)("sudoku.stopTimer"):k(m)("sudoku.startTimer")),1),O.value>0?(b(),_("span",rl,c(k(m)("sudoku.elapsedTime"))+": "+c(ve(O.value)),1)):T("",!0),a("button",{onClick:Ce},c(k(m)("sudoku.showAnswer")),1),a("button",{onClick:de},c(k(m)("sudoku.back")),1)]),w.value?(b(),_("div",cl,c(w.value),1)):T("",!0)]),B.value?(b(),_("div",il,[a("div",dl,[a("h3",null,c(k(m)("sudoku.answerTitle")),1),E.value?(b(),_("div",vl,"本题不唯一，仅供体验")):T("",!0),a("div",fl,[(b(),_(A,null,P(9,(t,s)=>a("div",{key:s,class:"row"},[(b(),_(A,null,P(9,(d,u)=>{var v,f,r;return a("span",{key:u},c(((r=(f=(v=K[h.value])==null?void 0:v[p.value])==null?void 0:f[s])==null?void 0:r[u])||""),1)}),64))])),64))]),a("button",{onClick:e[9]||(e[9]=t=>B.value=!1)},c(k(m)("sudoku.close")),1)])])):T("",!0)],64)):(b(),_(A,{key:1},[a("h2",null,c(k(m)("sudoku.title")),1),a("div",We,[a("button",{class:F({active:h.value==="classic"}),onClick:e[4]||(e[4]=t=>W("classic"))},c(k(m)("sudoku.classic")),3),a("button",{class:F({active:h.value==="diagonal"}),onClick:e[5]||(e[5]=t=>W("diagonal"))},c(k(m)("sudoku.diagonal")),3),a("button",{class:F({active:h.value==="killer"}),onClick:e[6]||(e[6]=t=>W("killer"))},c(k(m)("sudoku.killer")),3)]),a("div",Xe,[a("button",{onClick:$e},c(k(m)("sudoku.startGame")),1),a("button",{onClick:de},c(k(m)("sudoku.back")),1)])],64)),ee.value?(b(),_("div",ml,[a("div",kl,[a("h3",null,c(k(m)("sudoku.helpTitle")),1),a("ul",gl,[a("li",null,[a("b",null,c(k(m)("sudoku.classic"))+"：",1),Q(c(k(m)("sudoku.helpClassic")),1)]),a("li",null,[a("b",null,c(k(m)("sudoku.diagonal"))+"：",1),Q(c(k(m)("sudoku.helpDiagonal")),1)]),a("li",null,[a("b",null,c(k(m)("sudoku.killer"))+"：",1),Q(c(k(m)("sudoku.helpKiller")),1)])]),a("button",{class:"sudoku-help-close",onClick:e[10]||(e[10]=t=>ee.value=!1)},c(k(m)("sudoku.close")),1)])])):T("",!0)])])],64))}},_l=Ae(hl,[["__scopeId","data-v-6079f059"]]);export{_l as default};
