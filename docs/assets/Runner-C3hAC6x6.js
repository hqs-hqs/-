import{_ as _e,r as d,w as Te,f as Se,e as Pe,a as D,b as f,y as Y,g as z,A as F,T as N,n as ie,i as Z,l as Ge,o as H,h as We,t as m,E as Ce,u as b}from"./index-u-NLfMXx.js";const Ie={class:"canvas-wrap"},Ae=["width","height"],Re={class:"score-board"},Be={class:"best-score"},Ee={key:0,class:"start-panel"},Le={class:"start-content"},De={key:0,class:"pause-modal"},He={class:"pause-content"},qe={class:"pause-score"},Ye={class:"pause-score"},ze={key:0,class:"gameover-modal"},Fe={class:"gameover-content"},Ne={class:"pause-score"},je={class:"pause-score"},fe=120,he=200,R=20,j=80,V=72,Ve={__name:"Runner",setup(Ke){Z("lang"),Z("setLang");const w=Z("t"),de=Ge(),M=d(window.innerWidth),y=d(window.innerHeight),ee=d(null);let l,q;const W=d(0),k=d(0),B=d(Number(localStorage.getItem("runner_best_score")||0)),T=d(!1),g=d(!1),S=d(!1),v=d([]),c=d([]),t=d({x:100,y:0,vx:0,vy:0,r:18,onGround:!1}),s=d(0),C={a:!1,d:!1},ce=d("theme-day"),K=d(!1),x=d([]),ae=["none","rain","snow","fog"],P=d("none"),E=d(null),G=d([]),I=d([]);function O(){v.value=[];let e=0,o=y.value-V-10;for(;e<1e4;){let n=p(-80,80);Math.random()<.12&&(n+=p(-60,60)),o=Math.max(y.value-V-120,Math.min(y.value-V+60,o+n)),Math.random()<.08&&(o-=p(40,100)),Math.random()<.07&&(o+=p(40,80)),v.value.push({x:e,y:o}),e+=p(120,320)}}function A(e){for(let o=1;o<v.value.length;o++)if(e<v.value[o].x){const n=v.value[o-1],a=v.value[o],u=(e-n.x)/(a.x-n.x);return n.y*(1-u)+a.y*u}return y.value-V}function le(){if(P.value=ae[Math.floor(Math.random()*ae.length)],G.value=[],P.value==="rain")for(let e=0;e<60;e++)G.value.push({x:Math.random()*M.value,y:Math.random()*y.value,l:18+Math.random()*12,v:8+Math.random()*6});else if(P.value==="snow")for(let e=0;e<40;e++)G.value.push({x:Math.random()*M.value,y:Math.random()*y.value,r:2+Math.random()*2,v:1+Math.random()*1.5});else if(P.value==="fog")for(let e=0;e<8;e++)G.value.push({x:Math.random()*M.value,y:Math.random()*y.value,r:80+Math.random()*60,o:.08+Math.random()*.08})}function ye(){O(),c.value=[],x.value=[],I.value=[];let e=0,o=A(0)-60;for(let n=0;n<8;n++){const a=p(fe-40,he+80),u=Math.random()<.35?Math.random()*.6-.3:0;let r=A(e+a/2),h=Math.random()<.38,L=h?r-R:o;if(c.value.push({x:e,y:L,w:a,h:R,slope:u,stickToGround:h}),n>1&&Math.random()<.22){const i=o-p(80,120);c.value.push({x:e,y:i,w:a,h:R,slope:Math.random()<.5?Math.random()*.6-.3:0,stickToGround:!1})}if(n>1&&Math.random()<.5){const i=Math.random()<.5?"block":Math.random()<.5?"rotator":"spring";i==="block"?x.value.push({type:i,x:e+a/2,y:o-32,w:36,h:36,vx:0,vy:0}):i==="rotator"?x.value.push({type:i,x:e+a/2,y:o-32,r:32,angle:0,speed:.05+Math.random()*.04}):i==="spring"&&x.value.push({type:i,x:e+a/2,y:o-16,w:32,h:12,bounce:!0})}if(n>1&&Math.random()<.7){const i=p(1,Math.floor(a/48));for(let _=0;_<i;_++){const Q=e+24+_*48,$=o-56-(Math.random()<.3?p(0,32):0),J=Math.random()<.7?"brick":"question";I.value.push({type:J,x:Q,y:$,w:44,h:44,hit:!1,anim:0})}}e+=a+p(j-30,j+120),o=Math.max(120,Math.min(A(e)-60,o+p(-80,80)))}}function me(){const e=c.value[c.value.length-1];let o=e.x+e.w+p(j-30,j+120),n=Math.max(120,Math.min(A(o)-60,e.y+p(-80,80)));const a=p(fe-40,he+80),u=Math.random()<.35?Math.random()*.6-.3:0;let r=A(o+a/2),h=Math.random()<.38,L=h?r-R:n;if(c.value.push({x:o,y:L,w:a,h:R,slope:u,stickToGround:h}),Math.random()<.18){const i=n-p(80,120);c.value.push({x:o,y:i,w:a,h:R,slope:Math.random()<.5?Math.random()*.6-.3:0,stickToGround:!1})}if(Math.random()<.4){const i=Math.random()<.5?"block":Math.random()<.5?"rotator":"spring";i==="block"?x.value.push({type:i,x:o+a/2,y:n-32,w:36,h:36,vx:0,vy:0}):i==="rotator"?x.value.push({type:i,x:o+a/2,y:n-32,r:32,angle:0,speed:.05+Math.random()*.04}):i==="spring"&&x.value.push({type:i,x:o+a/2,y:n-16,w:32,h:12,bounce:!0})}if(Math.random()<.7){const i=p(1,Math.floor(a/48));for(let _=0;_<i;_++){const Q=o+24+_*48,$=n-56-(Math.random()<.3?p(0,32):0),J=Math.random()<.7?"brick":"question";I.value.push({type:J,x:Q,y:$,w:44,h:44,hit:!1,anim:0})}}}function p(e,o){return Math.floor(Math.random()*(o-e+1))+e}function te(){M.value=window.innerWidth,y.value=window.innerHeight,O(),ye(),t.value={x:c.value[0].x+40,y:c.value[0].y-20,vx:0,vy:0,r:18,onGround:!1},s.value=0,W.value=0,k.value=0,T.value=!0,g.value=!1,S.value=!1,x.value=[],I.value=[],U()}function U(){!T.value||g.value||(pe(),Me(),S.value||(q=requestAnimationFrame(U)))}function pe(){t.value.x+=t.value.vx,t.value.y+=t.value.vy,t.value.vy+=.6;let e=!1;for(let a of c.value)t.value.x+t.value.r>a.x&&t.value.x-t.value.r<a.x+a.w&&t.value.y+t.value.r>a.y&&t.value.y+t.value.r<a.y+a.h+8&&t.value.vy>=0&&t.value.y+t.value.r-t.value.vy<=a.y&&(t.value.y=a.y-t.value.r,t.value.vy=0,e=!0);const o=A(t.value.x);t.value.y+t.value.r>o&&t.value.vy>=0&&t.value.y+t.value.r-t.value.vy<=o&&(t.value.y=o-t.value.r,t.value.vy=0,e=!0),t.value.onGround=e,t.value.x<c.value[0].x+t.value.r&&(t.value.x=c.value[0].x+t.value.r),t.value.y>y.value&&X();const n=M.value/2;for(t.value.x>s.value+n&&(s.value=t.value.x-n);c.value[c.value.length-1].x<s.value+M.value+200;)me();for(let a of x.value)a.type==="rotator"&&(a.angle+=a.speed);for(let a of x.value)if(a.type==="block"){if(t.value.x+t.value.r>a.x-a.w/2&&t.value.x-t.value.r<a.x+a.w/2&&t.value.y+t.value.r>a.y-a.h/2&&t.value.y-t.value.r<a.y+a.h/2){X();return}}else if(a.type==="rotator"){const u=t.value.x-a.x,r=t.value.y-a.y;if(Math.sqrt(u*u+r*r)<a.r+t.value.r-8){X();return}}else a.type==="spring"&&t.value.x+t.value.r>a.x-a.w/2&&t.value.x-t.value.r<a.x+a.w/2&&Math.abs(t.value.y+t.value.r-a.y)<10&&t.value.vy>0&&(t.value.vy=-14);for(let a of I.value)!a.hit&&t.value.x+t.value.r>a.x-a.w/2&&t.value.x-t.value.r<a.x+a.w/2&&Math.abs(t.value.y-t.value.r-a.y-a.h/2)<8&&t.value.vy<0&&(a.hit=!0,a.anim=1,t.value.vy=4.5),a.anim>0&&(a.anim+=.3,a.anim>8&&(a.anim=0));W.value=Math.floor(t.value.x-c.value[0].x)}function Me(){if(l.clearRect(0,0,M.value,y.value),l.fillStyle="#4ecfff",l.fillRect(0,0,M.value,y.value),P.value==="rain"){l.save(),l.strokeStyle="rgba(80,180,255,0.55)",l.lineWidth=2;for(let e of G.value)l.beginPath(),l.moveTo(e.x,e.y),l.lineTo(e.x,e.y+e.l),l.stroke(),e.y+=e.v,e.y>y.value&&(e.y=-e.l,e.x=Math.random()*M.value);l.restore()}else if(P.value==="snow"){l.save(),l.fillStyle="rgba(255,255,255,0.85)";for(let e of G.value)l.beginPath(),l.arc(e.x,e.y,e.r,0,Math.PI*2),l.fill(),e.y+=e.v,e.x+=Math.sin(Date.now()/400+e.y/40),e.y>y.value&&(e.y=-e.r,e.x=Math.random()*M.value);l.restore()}else if(P.value==="fog"){l.save();for(let e of G.value)l.globalAlpha=e.o,l.beginPath(),l.arc(e.x,e.y,e.r,0,Math.PI*2),l.fillStyle="#dde6ee",l.fill();l.globalAlpha=1,l.restore()}xe(l);for(let e of I.value)e.x-s.value<-60||e.x-s.value>M.value+60||(e.type==="brick"?ve(l,e.x-e.w/2-s.value,e.y-e.h/2-(e.anim>0?e.anim:0),e.w,e.h,e.hit):e.type==="question"&&ge(l,e.x-e.w/2-s.value,e.y-e.h/2-(e.anim>0?e.anim:0),e.w,e.h,e.hit));for(let e of c.value)e.x+e.w<s.value-100||(l.save(),e.slope&&l.transform(1,e.slope,0,1,0,-e.slope*(e.x-s.value)),l.fillStyle="#8d5c1c",l.fillRect(e.x-s.value,e.y,e.w,e.h),l.fillStyle="#6fff4e",l.fillRect(e.x-s.value,e.y,e.w,8),l.beginPath(),l.arc(e.x-s.value+18,e.y+8,8,Math.PI,2*Math.PI),l.fillStyle="#4edc2f",l.fill(),l.restore(),l.save(),l.setLineDash([8,8]),l.strokeStyle="rgba(80,80,255,0.18)",l.lineWidth=3,l.beginPath(),l.moveTo(e.x-s.value+e.w/2,e.y-18),l.lineTo(e.x-s.value+e.w/2,e.y+e.h+18),l.stroke(),l.restore());for(let e of x.value)if(!(e.x-s.value<-100||e.x-s.value>M.value+100)){if(e.type==="block")l.save(),l.fillStyle="#444",l.strokeStyle="#fff",l.lineWidth=3,l.beginPath(),l.rect(e.x-e.w/2-s.value,e.y-e.h/2,e.w,e.h),l.fill(),l.stroke(),l.restore();else if(e.type==="rotator")l.save(),l.translate(e.x-s.value,e.y),l.rotate(e.angle),l.fillStyle="#f90",l.beginPath(),l.arc(0,0,e.r,0,Math.PI*2),l.fill(),l.strokeStyle="#fff",l.lineWidth=4,l.beginPath(),l.moveTo(0,0),l.lineTo(e.r,0),l.stroke(),l.restore();else if(e.type==="spring"){l.save(),l.fillStyle="#3af",l.strokeStyle="#fff",l.lineWidth=2,l.beginPath(),l.rect(e.x-e.w/2-s.value,e.y-e.h/2,e.w,e.h),l.fill(),l.stroke(),l.beginPath();for(let o=0;o<8;o++){const n=e.x-e.w/2+o/7*e.w-s.value,a=e.y-e.h/2+Math.sin(Date.now()/120+o)*4+e.h/2;o===0?l.moveTo(n,a):l.lineTo(n,a)}l.strokeStyle="#fff",l.lineWidth=1.5,l.stroke(),l.restore()}}l.beginPath(),l.arc(t.value.x-s.value,t.value.y,t.value.r,0,Math.PI*2),l.fillStyle="#e33",l.fill()}function X(){T.value=!1,S.value=!0,cancelAnimationFrame(q),W.value>B.value&&(B.value=W.value,localStorage.setItem("runner_best_score",W.value))}function we(){g.value=!0}function be(){g.value=!1,U()}function oe(){S.value=!1,g.value=!1,te()}function ne(){T.value=!1,g.value=!1,S.value=!1,cancelAnimationFrame(q),de.push("/hall")}function ue(e){!T.value||g.value||((e.key==="a"||e.key==="A")&&(C.a=!0,t.value.vx=-2.1),(e.key==="d"||e.key==="D")&&(C.d=!0,t.value.vx=2.1),(e.key==="w"||e.key==="W")&&t.value.onGround&&(t.value.vy=-7.5,t.value.onGround=!1))}function re(e){(e.key==="a"||e.key==="A")&&(C.a=!1,C.d?t.value.vx=2.1:t.value.vx=0),(e.key==="d"||e.key==="D")&&(C.d=!1,C.a?t.value.vx=-2.1:t.value.vx=0)}function se(){M.value=window.innerWidth,y.value=window.innerHeight,O()}Te(W,e=>{e>k.value&&(ke(e),K.value=!0,setTimeout(()=>K.value=!1,300))});function ke(e){if(k.value===e)return;let o=Math.max(1,Math.floor((e-k.value)/8));const n=setInterval(()=>{k.value<e?k.value+=o:k.value=e,k.value>=e&&clearInterval(n)},18)}function ve(e,o,n,a,u,r){e.save(),e.fillStyle=r?"#b97a56":"#d2691e",e.fillRect(o,n,a,u),e.strokeStyle="#fff6",e.lineWidth=2;for(let h=1;h<4;h++)e.beginPath(),e.moveTo(o+h*a/4,n),e.lineTo(o+h*a/4,n+u),e.stroke(),e.beginPath(),e.moveTo(o,n+h*u/4),e.lineTo(o+a,n+h*u/4),e.stroke();e.beginPath(),e.moveTo(o+4,n+4),e.lineTo(o+a-4,n+4),e.strokeStyle="#fff8",e.lineWidth=3,e.stroke(),e.restore()}function ge(e,o,n,a,u,r){e.save(),e.fillStyle=r?"#e2c04c":"#f7d560",e.fillRect(o,n,a,u),e.strokeStyle="#fff6",e.lineWidth=2;for(let h=1;h<4;h++)e.beginPath(),e.moveTo(o+h*a/4,n),e.lineTo(o+h*a/4,n+u),e.stroke(),e.beginPath(),e.moveTo(o,n+h*u/4),e.lineTo(o+a,n+h*u/4),e.stroke();e.font=`${Math.floor(a*.7)}px Arial Black`,e.fillStyle=r?"#bfae3a":"#b97a1e",e.textAlign="center",e.textBaseline="middle",e.fillText("?",o+a/2,n+u/2),e.beginPath(),e.moveTo(o+4,n+4),e.lineTo(o+a-4,n+4),e.strokeStyle="#fff8",e.lineWidth=3,e.stroke(),e.restore()}function xe(e){e.save();const o=160,n=8;e.beginPath(),e.moveTo(v.value[0].x-s.value,y.value-o);for(let a=0;a<v.value.length;a++){let u=v.value[a].y;for(let r of c.value)r.stickToGround&&Math.abs(r.x-v.value[a].x)<r.w/2&&(u=Math.min(u,r.y+r.h));e.lineTo(v.value[a].x-s.value,u)}e.lineTo(v.value[v.value.length-1].x-s.value,y.value-o),e.closePath(),e.fillStyle="#a86f2a",e.fill(),e.beginPath();for(let a=0;a<v.value.length;a++){let u=v.value[a].y;for(let r of c.value)r.stickToGround&&Math.abs(r.x-v.value[a].x)<r.w/2&&(u=Math.min(u,r.y+r.h));e.lineTo(v.value[a].x-s.value,u-n)}for(let a=v.value.length-1;a>=0;a--){let u=v.value[a].y;for(let r of c.value)r.stickToGround&&Math.abs(r.x-v.value[a].x)<r.w/2&&(u=Math.min(u,r.y+r.h));e.lineTo(v.value[a].x-s.value,u)}e.closePath(),e.fillStyle="#5fff3a",e.shadowColor="#fff",e.shadowBlur=8,e.fill(),e.shadowBlur=0;for(let a=0;a<v.value.length-1;a++){const u=v.value[a].x-s.value,r=v.value[a+1].x-s.value,h=v.value[a].y,L=v.value[a+1].y;for(let i=u;i<r;i+=44)for(let _=Math.max(h,L);_<y.value-o;_+=44)ve(e,i,_,44,44)}e.restore()}return Se(()=>{l=ee.value.getContext("2d"),window.addEventListener("keydown",ue),window.addEventListener("keyup",re),window.addEventListener("resize",se),le(),E.value&&clearInterval(E.value),E.value=setInterval(le,18e3)}),Pe(()=>{window.removeEventListener("keydown",ue),window.removeEventListener("keyup",re),window.removeEventListener("resize",se),cancelAnimationFrame(q),E.value&&clearInterval(E.value)}),(e,o)=>(H(),D("div",{class:ie(["runner-container",ce.value])},[f("div",Ie,[f("canvas",{ref_key:"canvas",ref:ee,width:M.value,height:y.value,class:"game-canvas"},null,8,Ae),T.value&&!g.value?(H(),D("div",{key:0,class:"pause-btn",onClick:we},o[0]||(o[0]=[f("span",{class:"pause-icon"},"⏸",-1)]))):z("",!0)]),Y(N,{name:"score-pop"},{default:F(()=>[We(f("div",Re,[o[1]||(o[1]=f("span",null,"分数：",-1)),f("span",{class:ie(["score-anim",{pop:K.value}])},m(k.value),3),f("span",Be,"最佳："+m(B.value),1)],512),[[Ce,T.value||g.value||S.value]])]),_:1}),Y(N,{name:"fade"},{default:F(()=>[!T.value&&!S.value&&!g.value?(H(),D("div",Ee,[f("div",Le,[o[2]||(o[2]=f("div",{class:"start-icon"},null,-1)),f("button",{class:"start-btn",onClick:te},m(b(w)("runner.start")),1)])])):z("",!0)]),_:1}),Y(N,{name:"modal-fade"},{default:F(()=>[g.value?(H(),D("div",De,[f("div",He,[f("h3",null,m(b(w)("runner.paused")),1),f("div",qe,m(b(w)("runner.currentScore"))+": "+m(k.value),1),f("div",Ye,m(b(w)("runner.bestScore"))+": "+m(B.value),1),f("button",{onClick:be},m(b(w)("runner.resume")),1),f("button",{onClick:oe},m(b(w)("runner.restart")),1),f("button",{onClick:ne},m(b(w)("runner.exit")),1)])])):z("",!0)]),_:1}),Y(N,{name:"modal-fade"},{default:F(()=>[S.value?(H(),D("div",ze,[f("div",Fe,[o[3]||(o[3]=f("div",{class:"gameover-icon"},null,-1)),f("h2",null,m(b(w)("runner.gameOver")),1),f("div",Ne,m(b(w)("runner.currentScore"))+": "+m(k.value),1),f("div",je,m(b(w)("runner.bestScore"))+": "+m(B.value),1),f("button",{onClick:oe},m(b(w)("runner.restart")),1),f("button",{onClick:ne},m(b(w)("runner.exit")),1)])])):z("",!0)]),_:1})],2))}},Ue=_e(Ve,[["__scopeId","data-v-ccf75f10"]]);export{Ue as default};
