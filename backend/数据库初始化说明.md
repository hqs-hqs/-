# 数据库初始化说明

## 📋 快速开始

### 步骤1：创建数据库

在 MySQL Workbench 中执行 `create_database.sql` 文件，或者直接执行以下 SQL：

```sql
CREATE DATABASE IF NOT EXISTS game_db
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;
```

### 步骤2：启动后端

启动后端项目后，**数据表会自动创建**，无需手动创建表。

---

## ✅ 自动创建表说明

### 配置说明

在 `application.properties` 中有以下配置：

```properties
spring.jpa.hibernate.ddl-auto=update
```

这个配置的作用：
- ✅ **`update`**：启动时自动检查表结构
  - 如果表不存在，**自动创建**
  - 如果表已存在但结构不同，**自动更新**
  - 不会删除已有数据

### 自动创建的表

后端启动时会自动创建以下表：

1. **`users`** - 用户表
   - 存储用户账号、密码、金币等信息

2. **`game_data`** - 游戏数据表
   - 存储各游戏的用户数据（JSON格式）
   - 包括打地鼠、数独等游戏数据

3. **`rank_records`** - 排行榜记录表
   - 存储所有游戏的排行榜数据

---

## 🚀 完整初始化流程

### 1. 安装 MySQL（如果未安装）

参考：`MySQL安装配置指南.md`

### 2. 创建数据库

**方式A：使用 MySQL Workbench**
1. 打开 MySQL Workbench
2. 连接到 MySQL 服务器
3. 打开 `create_database.sql` 文件
4. 执行 SQL 脚本（点击 ⚡ 按钮）

**方式B：使用命令行**
```bash
mysql -u root -p < create_database.sql
```

### 3. 配置数据库连接

编辑 `backend/src/main/resources/application.properties`：

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/game_db?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=你的MySQL密码  # 修改这里
```

### 4. 启动后端

```bash
cd backend
mvn spring-boot:run
```

启动日志中会看到：
```
Hibernate: create table users ...
Hibernate: create table game_data ...
Hibernate: create table rank_records ...
```

### 5. 验证

在 MySQL Workbench 中查看：
```sql
USE game_db;
SHOW TABLES;
```

应该能看到：
- `users`
- `game_data`
- `rank_records`

---

## ⚠️ 重要提示

### 不需要手动创建表

- ❌ **不需要**手动执行 `CREATE TABLE` 语句
- ❌ **不需要**手动创建表结构
- ✅ **只需要**创建数据库（`CREATE DATABASE`）
- ✅ 表会在后端启动时**自动创建**

### 数据表结构

表结构由 Java 实体类（Entity）定义：
- `User.java` → `users` 表
- `GameData.java` → `game_data` 表
- `RankRecord.java` → `rank_records` 表

如果修改了实体类，重启后端时会自动更新表结构。

---

## 🔧 其他配置选项

### `ddl-auto` 配置说明

| 配置值 | 说明 | 使用场景 |
|--------|------|----------|
| `none` | 不自动创建/更新表 | 生产环境（手动管理） |
| `validate` | 只验证表结构，不修改 | 生产环境 |
| `update` | 自动创建/更新表 | **开发环境（当前使用）** |
| `create` | 每次启动删除并重建表 | 测试环境（会丢失数据） |
| `create-drop` | 启动创建，关闭删除 | 测试环境 |

**当前配置：`update`** - 适合开发和演示使用。

---

## 📝 给老师的说明

### 初始化步骤（简化版）

1. **安装 MySQL**（如果未安装）
   - 参考：`MySQL安装配置指南.md`

2. **创建数据库**
   - 在 MySQL Workbench 中执行 `create_database.sql`
   - 或执行：`CREATE DATABASE IF NOT EXISTS game_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`

3. **配置数据库密码**
   - 编辑 `backend/src/main/resources/application.properties`
   - 修改 `spring.datasource.password=你的MySQL密码`

4. **启动后端**
   - 运行 `GameApplication.java` 或执行 `mvn spring-boot:run`
   - 数据表会自动创建

5. **验证**
   - 在 MySQL Workbench 中查看 `game_db` 数据库
   - 应该能看到自动创建的表

### 常见问题

**Q: 表没有自动创建？**
- 检查 MySQL 服务是否运行
- 检查数据库连接配置是否正确
- 查看后端启动日志是否有错误

**Q: 如何重置数据库？**
- 删除数据库：`DROP DATABASE game_db;`
- 重新执行 `create_database.sql`
- 重启后端，表会自动创建

**Q: 如何查看表结构？**
```sql
USE game_db;
DESCRIBE users;
DESCRIBE game_data;
DESCRIBE rank_records;
```

---

## 📚 相关文件

- `create_database.sql` - 数据库创建脚本
- `application.properties` - 数据库连接配置
- `MySQL安装配置指南.md` - MySQL 安装说明
- `MySQL数据查询指南.md` - 数据查询说明

